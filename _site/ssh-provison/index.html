<!DOCTYPE html><html lang="en-US"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><link rel="stylesheet" href="/assets/css/just-the-docs-default.css"> <script src="/assets/js/vendor/lunr.min.js"></script> <script src="/assets/js/just-the-docs.js"></script><meta name="viewport" content="width=device-width, initial-scale=1"><title>Instalar y Configurar SSH | DevOps, Informática y Linux en Español</title><meta name="generator" content="Jekyll v3.9.3" /><meta property="og:title" content="Instalar y Configurar SSH" /><meta name="author" content="al foot" /><meta property="og:locale" content="en_US" /><meta name="description" content="Exposición práctica de Informática, Entrega Continua e Integración Continua. Incluye temas del Sistema Operativo de Linux, Ansible, Docker, Kubernetes, Jenkins, Base de Datos, y más." /><meta property="og:description" content="Exposición práctica de Informática, Entrega Continua e Integración Continua. Incluye temas del Sistema Operativo de Linux, Ansible, Docker, Kubernetes, Jenkins, Base de Datos, y más." /><link rel="canonical" href="http://localhost:4000/ssh-provison/" /><meta property="og:url" content="http://localhost:4000/ssh-provison/" /><meta property="og:site_name" content="DevOps, Informática y Linux en Español" /><meta property="og:type" content="website" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Instalar y Configurar SSH" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"al foot"},"description":"Exposición práctica de Informática, Entrega Continua e Integración Continua. Incluye temas del Sistema Operativo de Linux, Ansible, Docker, Kubernetes, Jenkins, Base de Datos, y más.","headline":"Instalar y Configurar SSH","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/assets/images/site_logo.jpg"},"name":"al foot"},"url":"http://localhost:4000/ssh-provison/"}</script><body> <a class="skip-to-main" href="#main-content">Skip to main content</a> <svg xmlns="http://www.w3.org/2000/svg" class="d-none"> <symbol id="svg-link" viewBox="0 0 24 24"><title>Link</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"><title>Menu</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"><title>Expand</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"><polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link"><title id="svg-external-link-title">(external link)</title><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"><title>Document</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"><title>Search</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-copy" viewBox="0 0 16 16"><title>Copy</title><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/><path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/> </svg> </symbol> <symbol id="svg-copied" viewBox="0 0 16 16"><title>Copied</title><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16"><path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/> </svg> </symbol> </svg><div class="side-bar"><div class="site-header"> <a href="/" class="site-title lh-tight"><div class="site-logo"></div></a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a></div><nav aria-label="Main" id="site-nav" class="site-nav"><ul class="nav-list"><li class="nav-list-item"><a href="/devops-en-espa%C3%B1ol/" class="nav-list-link">DevOps</a><li class="nav-list-item active"><a href="#" class="nav-list-expander" aria-label="toggle links in Linux category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/linux-en-espa%C3%B1ol/" class="nav-list-link">Linux</a><ul class="nav-list"><li class="nav-list-item "><a href="/linux-conceptos/" class="nav-list-link">Conceptos</a><li class="nav-list-item "><a href="/linux-provision/" class="nav-list-link">Provision</a><li class="nav-list-item "><a href="/linux_initial_environment/" class="nav-list-link">Ambiente de Inicio</a><li class="nav-list-item "><a href="/linux_help/" class="nav-list-link">Ayuda y Paginas Manuales</a><li class="nav-list-item "><a href="#" class="nav-list-expander" aria-label="toggle links in Comandos y Procesos category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/linux-commandos/" class="nav-list-link">Comandos y Procesos</a><ul class="nav-list"><li class="nav-list-item "> <a href="/ficheros-y-directorios/" class="nav-list-link">Ficheros y Directorios</a><li class="nav-list-item "> <a href="/permiso-ficheros/" class="nav-list-link">Permisos Ficheros</a><li class="nav-list-item "> <a href="/editando-ficheros/" class="nav-list-link">Editando Ficheros</a><li class="nav-list-item "> <a href="/auditar-procesos/" class="nav-list-link">Auditar Procesos</a><li class="nav-list-item "> <a href="/cuentas-suarios/" class="nav-list-link">Cuentas de Usuarios</a></ul><li class="nav-list-item "><a href="#" class="nav-list-expander" aria-label="toggle links in Manejando Paquetes category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/manejar-paquetes-linux/" class="nav-list-link">Manejando Paquetes</a><ul class="nav-list"><li class="nav-list-item "> <a href="/rhel-package-management/" class="nav-list-link">Paquetes en RedHat</a><li class="nav-list-item "> <a href="/ubuntu-manejar-paquetes/" class="nav-list-link">Paquetes en Ubuntu</a><li class="nav-list-item "> <a href="/rpmbuild-centos-redhat/" class="nav-list-link">RPMBuild</a></ul><li class="nav-list-item "><a href="#" class="nav-list-expander" aria-label="toggle links in El Shell category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/linux-shell/" class="nav-list-link">El Shell</a><ul class="nav-list"><li class="nav-list-item "> <a href="/dircolors-terminal/" class="nav-list-link">DirColors en la Terminal</a></ul><li class="nav-list-item active"><a href="#" class="nav-list-expander" aria-label="toggle links in SSH category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/ssh-linux/" class="nav-list-link">SSH</a><ul class="nav-list"><li class="nav-list-item active"> <a href="/ssh-provison/" class="nav-list-link active">Instalar y Configurar SSH</a><li class="nav-list-item "> <a href="/ssh-implementation/" class="nav-list-link">Implementación de SSH</a><li class="nav-list-item "> <a href="/ssh-sin-contrasena/" class="nav-list-link">SSH sin Contraseña</a></ul></ul><li class="nav-list-item"><a href="#" class="nav-list-expander" aria-label="toggle links in Git category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/git-en-espa%C3%B1ol/" class="nav-list-link">Git</a><ul class="nav-list"><li class="nav-list-item "><a href="/provision-git/" class="nav-list-link">Provisión Git</a><li class="nav-list-item "><a href="/git-branches-pr/" class="nav-list-link">Ramas y PR</a><li class="nav-list-item "><a href="/implementation-de-git/" class="nav-list-link">Implementación Git</a></ul><li class="nav-list-item"><a href="#" class="nav-list-expander" aria-label="toggle links in Ansible category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/ansible/" class="nav-list-link">Ansible</a><ul class="nav-list"><li class="nav-list-item "><a href="/conceptos-de-ansible/" class="nav-list-link">Conceptos Ansible</a><li class="nav-list-item "><a href="/provision-de-ansible/" class="nav-list-link">Provisión Ansible</a><li class="nav-list-item "><a href="/implementacion-de-ansible/" class="nav-list-link">Implementación Ansible</a></ul><li class="nav-list-item"><a href="#" class="nav-list-expander" aria-label="toggle links in Docker category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/docker-en-espa%C3%B1ol/" class="nav-list-link">Docker</a><ul class="nav-list"><li class="nav-list-item "><a href="/docker_list/" class="nav-list-link">Listar En Docker</a><li class="nav-list-item "><a href="/docker_compose/" class="nav-list-link">Docker Compose</a><li class="nav-list-item "><a href="/docker_provision/" class="nav-list-link">Provisión Docker en CentOS</a><li class="nav-list-item "><a href="/docker_provision/" class="nav-list-link">Provisión Docker en Ubuntu</a><li class="nav-list-item "><a href="/docker_implementation/" class="nav-list-link">Implementación Docker</a></ul><li class="nav-list-item"><a href="#" class="nav-list-expander" aria-label="toggle links in Minikube category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/minikube-en-espa%C3%B1ol/" class="nav-list-link">Minikube</a><ul class="nav-list"><li class="nav-list-item "><a href="/minikube-conceptos/" class="nav-list-link">Conceptos Minikube</a><li class="nav-list-item "><a href="#" class="nav-list-expander" aria-label="toggle links in Provisión Minikube category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/minikube-provision/" class="nav-list-link">Provisión Minikube</a><ul class="nav-list"></ul><li class="nav-list-item "><a href="/minikube-implementacion/" class="nav-list-link">Implementacion Minikube</a></ul><li class="nav-list-item"><a href="#" class="nav-list-expander" aria-label="toggle links in Kubernetes category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/kubernetes-en-espa%C3%B1ol/" class="nav-list-link">Kubernetes</a><ul class="nav-list"><li class="nav-list-item "><a href="/conceptos-de-kubernetes/" class="nav-list-link">Conceptos Kubernetes</a><li class="nav-list-item "><a href="/provision-de-kubernetes/" class="nav-list-link">Provisión Kubernetes</a><li class="nav-list-item "><a href="/implementation-de-kubernetes/" class="nav-list-link">Implemetación Kubernetes</a></ul><li class="nav-list-item"><a href="#" class="nav-list-expander" aria-label="toggle links in Postgresql category"> <svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg> </a><a href="/postgresql-en-espa%C3%B1ol/" class="nav-list-link">Postgresql</a><ul class="nav-list"><li class="nav-list-item "><a href="/conceptos-postgresql/" class="nav-list-link">Conceptos Postgresql</a><li class="nav-list-item "><a href="/provision-postgresql/" class="nav-list-link">Provisión Postgresql</a><li class="nav-list-item "><a href="/implementation-postgresql/" class="nav-list-link">Implemetación Postgresql</a></ul><li class="nav-list-item"><a href="/news/" class="nav-list-link">News</a><li class="nav-list-item"><a href="/about/" class="nav-list-link">About</a><li class="nav-list-item"><a href="/markdown/" class="nav-list-link">Markdown CheatSheet</a></ul><ul class="nav-list"><li class="nav-list-item external"> <a href="https://www.youtube.com/channel/UCSCaMvc6CFHoWj4kqpvNm3w" class="nav-list-link external"> DevESP en Youtube <svg viewBox="0 0 24 24" aria-labelledby="svg-external-link-title"><use xlink:href="#svg-external-link"></use></svg> </a></ul></nav><footer class="site-footer"> This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.</footer></div><div class="main" id="top"><div id="main-header" class="main-header"><div class="search"><div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search DevOps, Informática y Linux en Español" aria-label="Search DevOps, Informática y Linux en Español" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label></div><div id="search-results" class="search-results"></div></div><nav aria-label="Auxiliary" class="aux-nav"><ul class="aux-nav-list"><li class="aux-nav-list-item"> <a href="https://www.youtube.com/channel/UCSCaMvc6CFHoWj4kqpvNm3w" class="site-button" target="_blank" rel="noopener noreferrer" > Vea DevESP en Youtube </a></ul></nav></div><div id="main-content-wrap" class="main-content-wrap"><nav aria-label="Breadcrumb" class="breadcrumb-nav"><ol class="breadcrumb-nav-list"><li class="breadcrumb-nav-list-item"><a href="/linux-en-espa%C3%B1ol/">Linux</a><li class="breadcrumb-nav-list-item"><a href="/ssh-linux/">SSH</a><li class="breadcrumb-nav-list-item"><span>Instalar y Configurar SSH</span></ol></nav><div id="main-content" class="main-content" role="main"><h1 class="no_toc" id="instalar-y-configurar-ssh"> <a href="#instalar-y-configurar-ssh" class="anchor-heading" aria-labelledby="instalar-y-configurar-ssh"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Instalar y Configurar SSH</h1><details open=""> <summary class="text-delta"> Table of contents </summary><ul id="markdown-toc"><li><a href="#instalar-openssh-on-rhel9" id="markdown-toc-instalar-openssh-on-rhel9">Instalar OpenSSH on RHEL9</a><li><a href="#instalar-openssh-on-ubuntu-2204" id="markdown-toc-instalar-openssh-on-ubuntu-2204">Instalar OpenSSH on UBUNTU 22.04</a><li><a href="#proteger-openssh" id="markdown-toc-proteger-openssh">Proteger OpenSSH</a><ul><li><a href="#poner-permisos-al-fichero-de-configuración" id="markdown-toc-poner-permisos-al-fichero-de-configuración">Poner permisos al fichero de configuración</a><li><a href="#poner-el-nivel-de-log-apropiado" id="markdown-toc-poner-el-nivel-de-log-apropiado">Poner el nivel de log apropiado</a><li><a href="#abilitar-pam" id="markdown-toc-abilitar-pam">Abilitar PAM</a><li><a href="#deabilitar-logins-de-root" id="markdown-toc-deabilitar-logins-de-root">Deabilitar logins de root</a><li><a href="#desabilitar-rhosts" id="markdown-toc-desabilitar-rhosts">Desabilitar RHOSTS</a><li><a href="#contraseñas-vacias-no-se-permiten" id="markdown-toc-contraseñas-vacias-no-se-permiten">Contraseñas vacias no se permiten</a><li><a href="#desabilitar-variables-de-ambiente" id="markdown-toc-desabilitar-variables-de-ambiente">Desabilitar Variables de Ambiente</a><li><a href="#desabilitar-x11-forwarding" id="markdown-toc-desabilitar-x11-forwarding">Desabilitar X11 Forwarding</a><li><a href="#desabilitar-tcp-forwarding" id="markdown-toc-desabilitar-tcp-forwarding">Desabilitar TCP Forwarding</a><li><a href="#crear-un-banner" id="markdown-toc-crear-un-banner">Crear un banner</a><li><a href="#numero-máximo-de-atentados" id="markdown-toc-numero-máximo-de-atentados">Numero Máximo de Atentados</a></ul></ul></details><hr /><h2 id="instalar-openssh-on-rhel9"> <a href="#instalar-openssh-on-rhel9" class="anchor-heading" aria-labelledby="instalar-openssh-on-rhel9"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Instalar OpenSSH on RHEL9</h2><p>En Linux SSH es mas conocido como OpenSSH, de hecho todos los paquetes de esta utilidad usan el nombre <code class="language-plaintext highlighter-rouge">openssh</code>.</p><p>Dependienddo del caso, debemos installer el cliente o servidor de OpenSSH antes que podamos usarlo.</p><p>Ent RHEL9 y CentOS, entrar este comando para instalar los ficheros principales, el client y servidor.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Sun 2023Jun25 23:33:33 UTC
root@client3 <span class="o">[</span> RHEL9 <span class="o">]</span>
hist:22 -&gt; yum <span class="nb">install </span>openssh.x86_64 openssh-clients.x86_64 openssh-server.x86_64
</code></pre></div></div><dl><dt>openssh.x86_64<dd>Este paquete incluye los ficheros principales necesarios para el cliente y servidor de OpenSSH.<dt>openssh-clients<dd>Este paquete incluye los clientes necesarios para hacer connecciones cifrada a servidors de SSH.<dt>openssh-server<dd>Este paquete contiene el Secure Shell Damon (sshd). El damon permite que clientes de SSH se connecte en forma segura al servidor de SSH.</dl><p>Verifiquemos los paquetes instalados</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-&gt; rpm <span class="nt">-qa</span> | <span class="nb">grep </span>openssh
openssh-8.7p1-29.el9_2.x86_64
openssh-clients-8.7p1-29.el9_2.x86_64
openssh-server-8.7p1-29.el9_2.x86_64
</code></pre></div></div><p>Este comando nos muestra le fichero de configuracion <code class="language-plaintext highlighter-rouge">/etc/ssh/sshd_config</code>.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-&gt; rpm <span class="nt">-qc</span> openssh-server-8.7p1-29.el9_2.x86_64
/etc/pam.d/sshd
/etc/ssh/sshd_config
/etc/ssh/sshd_config.d/50-redhat.conf
/etc/sysconfig/sshd
</code></pre></div></div><p>En RHEL9, el directorio <code class="language-plaintext highlighter-rouge">/etc/ssh</code> contiene todos los fichers de configuracion.<br /> El fichero de configuracion es <code class="language-plaintext highlighter-rouge">/etc/ssh/sshd_config</code>.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@client3 [ RHEL9 ]
hist:29 -&gt; ls -l /etc/ssh
total 584
-rw-r--r-- 1 root root 578094 Apr 13 13:01 moduli
-rw-r--r-- 1 root root   1921 Apr 13 13:01 ssh_config
drwxr-xr-x 2 root root   4096 Jun 25 23:43 ssh_config.d/
-rw------- 1 root root   3667 Apr 13 13:01 sshd_config
drwx------ 2 root root   4096 Jun 25 23:43 sshd_config.d/
</code></pre></div></div><h2 id="instalar-openssh-on-ubuntu-2204"> <a href="#instalar-openssh-on-ubuntu-2204" class="anchor-heading" aria-labelledby="instalar-openssh-on-ubuntu-2204"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Instalar OpenSSH on UBUNTU 22.04</h2><p>En Ubuntu 22.04, entrar este comando para instalar el client y servidor.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-&gt; apt <span class="nb">install </span>openssh-client openssh-server
</code></pre></div></div><p>Las definiciones de cada paquete en CentOS tambien se aplican a Ubuntu.</p><p>Este comando nos muestra la lista parcial de ficheros que incluyen el fichero de configuracion.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Sun 2023Jun25 23:47:03 UTC
root@client2 <span class="o">[</span> U2204 <span class="o">]</span>
~
hist:42 -&gt;  dpkg-query <span class="nt">-L</span> openssh-server
/.
/etc
/etc/init.d/ssh
/etc/pam.d
/etc/pam.d/sshd
/etc/ssh
/etc/ssh/moduli
/etc/ssh/sshd_config.d
/usr/sbin/sshd
</code></pre></div></div><p>En Ubuntu, el directorio <code class="language-plaintext highlighter-rouge">/etc/ssh</code> contiene todos los fichers de configuracion.<br /> El fichero de configuracion es <code class="language-plaintext highlighter-rouge">/etc/ssh/sshd_config</code>.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Sun 2023Jun25 23:51:57 UTC
root@client2 <span class="o">[</span> U2204 <span class="o">]</span>
/etc/ssh
hist:47 -&gt; <span class="nb">ls</span> <span class="nt">-l</span> /etc/ssh
total 540
<span class="nt">-rw-r--r--</span> 1 root root 505426 Nov 23  2022 moduli
<span class="nt">-rw-r--r--</span> 1 root root   1650 Nov 23  2022 ssh_config
drwxr-xr-x 2 root root   4096 Nov 23  2022 ssh_config.d/
<span class="nt">-rw-------</span> 1 root root    505 Jun 25 23:44 ssh_host_ecdsa_key
<span class="nt">-rw-r--r--</span> 1 root root    174 Jun 25 23:44 ssh_host_ecdsa_key.pub
<span class="nt">-rw-------</span> 1 root root    399 Jun 25 23:44 ssh_host_ed25519_key
<span class="nt">-rw-r--r--</span> 1 root root     94 Jun 25 23:44 ssh_host_ed25519_key.pub
<span class="nt">-rw-------</span> 1 root root   2602 Jun 25 23:44 ssh_host_rsa_key
<span class="nt">-rw-r--r--</span> 1 root root    566 Jun 25 23:44 ssh_host_rsa_key.pub
<span class="nt">-rw-r--r--</span> 1 root root    342 Dec  7  2020 ssh_import_id
<span class="nt">-rw-r--r--</span> 1 root root   3254 Nov 23  2022 sshd_config
drwxr-xr-x 2 root root   4096 Nov 23  2022 sshd_config.d/
</code></pre></div></div><h2 id="proteger-openssh"> <a href="#proteger-openssh" class="anchor-heading" aria-labelledby="proteger-openssh"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Proteger OpenSSH</h2><h3 id="poner-permisos-al-fichero-de-configuración"> <a href="#poner-permisos-al-fichero-de-configuración" class="anchor-heading" aria-labelledby="poner-permisos-al-fichero-de-configuración"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Poner permisos al fichero de configuración</h3><blockquote class="warning"><p>Hagamos copias de los ficheros antes de hacer cambios.</p></blockquote><p>Copiemos le fichero <code class="language-plaintext highlighter-rouge">/etc/ssh/sshd_config</code> para protegerlo de que sea cambiado al quitarle el permiso de escribir.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cp</span> /etc/ssh/sshd_config /etc/ssh/sshd_config_ORIG
<span class="nb">chmod </span>a-w /etc/ssh/sshd_config_ORIG
</code></pre></div></div><p>Poner los permision apropiados del fichero de configuración.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">chown </span>root:root /etc/ssh/sshd_config 
<span class="nb">chmod </span>og-rwx /etc/ssh/sshd_config
</code></pre></div></div><p>Verifiquemos.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-&gt; <span class="nb">stat</span> /etc/ssh/sshd_config
  File: /etc/ssh/sshd_config
  Size: 3667      	Blocks: 8          IO Block: 4096   regular file
Device: 100034h/1048628d	Inode: 3834901     Links: 1
Access: <span class="o">(</span>0600/-rw-------<span class="o">)</span>  Uid: <span class="o">(</span>    0/    root<span class="o">)</span>   Gid: <span class="o">(</span>    0/    root<span class="o">)</span>
Access: 2023-06-26 00:00:23.352573142 +0000
Modify: 2023-04-13 13:01:49.000000000 +0000
Change: 2023-06-26 00:08:52.401172205 +0000
 Birth: 2023-06-25 23:43:46.435161012 +0000
</code></pre></div></div><h3 id="poner-el-nivel-de-log-apropiado"> <a href="#poner-el-nivel-de-log-apropiado" class="anchor-heading" aria-labelledby="poner-el-nivel-de-log-apropiado"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Poner el nivel de log apropiado</h3><p>Editar /etc/ssh/sshd_config y poner el parametro mostrado.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>LogLevel INFO
</code></pre></div></div><h3 id="abilitar-pam"> <a href="#abilitar-pam" class="anchor-heading" aria-labelledby="abilitar-pam"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Abilitar PAM</h3><p>Cuando UsePAM se usa, PAM observa los modulos de account y session. Eso es importante si queremos restringir acceso a servicios basados en el ip address, tiempo u otros aspectos de la cuenta de usuario.</p><p>Editar /etc/ssh/sshd_config y poner el parametro mostrado.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>UsePAM <span class="nb">yes</span>
</code></pre></div></div><h3 id="deabilitar-logins-de-root"> <a href="#deabilitar-logins-de-root" class="anchor-heading" aria-labelledby="deabilitar-logins-de-root"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Deabilitar logins de root</h3><p>Esto bloquea logins para el usuario raiz (root). Requiere que usuarios entren con su propia cuenta y de acuerdo a privilegios pueden acceder la raiz una vez que han entrado al sistema.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PermitRootLogin no
</code></pre></div></div><h3 id="desabilitar-rhosts"> <a href="#desabilitar-rhosts" class="anchor-heading" aria-labelledby="desabilitar-rhosts"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Desabilitar RHOSTS</h3><p>Con esto no se permite el uso del fichero <code class="language-plaintext highlighter-rouge">.rhosts</code> o <code class="language-plaintext highlighter-rouge">/etc/hosts.equiv</code> si esta presente.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>IgnoreRhosts <span class="nb">yes</span>
</code></pre></div></div><h3 id="contraseñas-vacias-no-se-permiten"> <a href="#contraseñas-vacias-no-se-permiten" class="anchor-heading" aria-labelledby="contraseñas-vacias-no-se-permiten"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Contraseñas vacias no se permiten</h3><p>Esto bloquea el uso de contraseñas vacias en el servidor the SSH.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PermitEmptyPasswords no
</code></pre></div></div><h3 id="desabilitar-variables-de-ambiente"> <a href="#desabilitar-variables-de-ambiente" class="anchor-heading" aria-labelledby="desabilitar-variables-de-ambiente"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Desabilitar Variables de Ambiente</h3><p>Esto no permite que usuarios pongan variables de ambiente a travez del deamon de SSH, lo cual podria potencialmente sobrepasar los protocolos de seguridad.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PermitUserEnvironment no
</code></pre></div></div><h3 id="desabilitar-x11-forwarding"> <a href="#desabilitar-x11-forwarding" class="anchor-heading" aria-labelledby="desabilitar-x11-forwarding"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Desabilitar X11 Forwarding</h3><p>Desabilitar el uso de aplicaciones X11 directamente al conectarse al servidor de OpenSSH.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>X11Forwarding no
</code></pre></div></div><h3 id="desabilitar-tcp-forwarding"> <a href="#desabilitar-tcp-forwarding" class="anchor-heading" aria-labelledby="desabilitar-tcp-forwarding"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Desabilitar TCP Forwarding</h3><p>SSH port forwarding es un mecanismo para crear tuneles desde el cliente al servidor o vicerversa. Un usuario malicioso podria crear una puerta trasera para entrar a la red interna desde su computadora personal. Esto es inherentemente un riesgo muy alto que no debe permitirse.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>AllowTcpForwarding yes
</code></pre></div></div><h3 id="crear-un-banner"> <a href="#crear-un-banner" class="anchor-heading" aria-labelledby="crear-un-banner"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Crear un banner</h3><p>Poner esta linea y crear el fichero <code class="language-plaintext highlighter-rouge">/etc/issue</code> con un mensaje indicando directivas de privacidad u otras guías necesarias que indiquen la politica interna de uso y seguridad.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Banner /etc/issue
</code></pre></div></div><h3 id="numero-máximo-de-atentados"> <a href="#numero-máximo-de-atentados" class="anchor-heading" aria-labelledby="numero-máximo-de-atentados"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Numero Máximo de Atentados</h3><p>Con esto limitamos el número de atentados que el usuario tiene antes que sea bloqueado del sistema. De esta manera reducimos la posibilidad de ataques de fuerza bruta para infiltrar el sistema ilegalmente.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>MaxAuthTries 6
</code></pre></div></div><hr><footer><p><a href="#top" id="back-to-top">Back to top</a></p>Copyright © 2023 Al Foot.<div class="d-flex mt-2"></div></footer></div></div><a href="#" id="search-button" class="search-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-search"></use></svg> </a><div class="search-overlay"></div></div>
